<div class="nav-div">
<button type="button" ng-click="continueToPrevDoc()">></button>
<h2>document #{{document.data.id}}</h2>
<button type="button" ng-click="continueToNextDoc()"><</button>
</div>
<div class="table-wrap compact-view">
<table class="reconcile-table" ng-class="{'focus-mode':focusedBlock}">
<thead ng-click="unsetBlockFocus()">
<tr>
	<th ng-repeat="(k, q) in document.data.annotations">
		<div dir="ltr">
			<span>{{q.label}}</span>
			<span>
				(
				<span>{{q.reconciled.length}},</span>
				<span ng-repeat="(j, u) in document.data.users">{{q.answers[u].answers.length}}<span ng-show="!$last">,</span></span>
				)
			</span>
		</div>
	</th>
</tr>
<tr>
	<th ng-repeat="(k, q) in document.data.annotations">
	<div class="reconciled">
	<div class="block" tabindex="{{(k+1)*(l+1)}}" ng-repeat="(l, a) in q.reconciled track by l"
	ng-click="a.isFocused?unsetBlockFocus():setBlockFocus(k, l); $event.stopPropagation();"
	ng-keyup="oncommittedBlockKeyup($event, k, l)"
	ng-class="{'focused':a.isFocused}">
	<div class="property" ng-repeat="(m, key) in objectKeys(a)">
	<label class="property-label">{{key}}</label>
	<input ng-if="!textareaFields.has(q.label)" class="property-input" type="text" ng-model="a[key]"}
	ng-keyup="$event.stopPropagation();"
	/>
	<textarea ng-if="textareaFields.has(q.label)" class="property-input" type="text" ng-model="a[key]"}
	ng-keyup="$event.stopPropagation();"
	oninput='this.style.height = ""; this.style.height = (5 + this.scrollHeight) + "px"'
	></textarea>
	</div>
	</div>
	</div>
	</th>
</tr>
</thead>
<tbody>
<tr ng-repeat="(j, u) in document.data.users">
	<td ng-repeat="(k, q) in document.data.annotations">
	<div class="user-answer">
	<div class="block" ng-repeat="(l, a) in q.answers[u].answers"
		ng-click="focusedBlock?null:commitBlock(k, a)">
	<div class="property" ng-repeat="(m, key) in objectKeys(a['ans'])"
		ng-click="(focusedBlock && (focusedBlock.q === k))?transferProperty(u, k, l, key, $event):null;"
		ng-class="{'committed':isCommitted(q, a['ans'], key)}">
	<label class="property-label">{{key}}</label>
	<div class="property-value">{{a['ans'][key]}}</div>
	</div>
	</div>
	</div>
	</td>
</tr>
</tbody>
</table>
</div>
<div class="tag-selector">
	<span>בחירת נושאים:</span>
	<input type="text" list="tags" ng-model="currTag.name" ng-change="tags.indexOf(currTag.name)!==-1?addTag():null" ng-keyup="$event.keyCode===13&&currTag.name&&currTag.name.length?addTag():null"/>
	<datalist id="tags">
		<option ng-repeat="t in tags" value="{{t}}">
	</datalist>
	<div ng-repeat="(i, t) in selectedTags" class="tag">
		<span>{{t}}</span>
		<button type="button" ng-click="removeTag(i)">X</button>
	</div>
</div>
<div class="save-wrap">
	<label>להחליף את הסטטוס ל</label>
	<select ng-model="document.status" ng-options="s.val as s.label for s in docStatusOptions"></select>
	<button type="button" ng-click="saveDoc()">שמירה</button>
	<span ng-show="saveSuccessful">השמירה הצליחה! מעבר אוטמטי למסמך הבא ייתבצע עוד מעט</span>
</div>
<div class="doc-display">
	<button type="button" ng-click="goToPage(currPage-1)" ng-disabled="currPage <= 0"><</button>
	<div>
		<img alt="page-{{currPage}}" src="{{pages[currPage]}}" class="page-img"
		ng-style="{'filter': 'brightness('+imgControls.brightness+'%) contrast('+imgControls.contrast+'%) saturate('+imgControls.saturation+'%)'}"/>
		<div dir="ltr" class="page-img-controls">
			<div>
				<label>brightness</label>
				<input type="range" min="20" max="160" step="1" ng-model="imgControls.brightness"/>
			</div>
			<div>
				<label>contrast</label>
				<input type="range" min="50" max="200" step="1" ng-model="imgControls.contrast"/>
			</div>
			<div>
				<label>saturation</label>
				<input type="range" min="0" max="100" step="1" ng-model="imgControls.saturation"/>
			</div>
		</div>
	</div>
	<button type="button" ng-click="goToPage(currPage+1)" ng-disabled="currPage >= (pages.length - 1)">></button>
</div>